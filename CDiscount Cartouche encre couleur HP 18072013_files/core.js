(function(localWindow){var CORE={VERSION:"9.2.2",documentAlias:localWindow.document,linkElements:localWindow.document.links,navigatorAlias:localWindow.navigator,escapeWrapper:localWindow.encodeURIComponent||localWindow.escape},gCAN=null,gS=null,Ctor=function(){},inherits=function(parent,protoProps,staticProps){var child;if(protoProps&&protoProps.hasOwnProperty("constructor")){child=protoProps.constructor;}else{child=function(){parent.apply(this,arguments);};}CORE._extend(child,parent);Ctor.prototype=parent.prototype;child.prototype=new Ctor();if(protoProps){CORE._extend(child.prototype,protoProps);}if(staticProps){CORE._extend(child,staticProps);}child.prototype.constructor=child;child.__super__=parent.prototype;return child;};CORE.each=function(obj,iterator,context){var breaker={},i,l,key;if(null===obj){return;}if(Array.prototype.forEach&&obj.forEach===Array.prototype.forEach){obj.forEach(iterator,context);}else{if(obj.length===+obj.length){for(i=0,l=obj.length;i<l;i++){if(iterator.call(context,obj[i],i,obj)===breaker){return;}}}else{for(key in obj){if(obj.hasOwnProperty(key)){if(iterator.call(context,obj[key],key,obj)===breaker){return;}}}}}};CORE._extend=function(obj){CORE.each(Array.prototype.slice.call(arguments,1),function(source){var prop;for(prop in source){if(source.hasOwnProperty(prop)){obj[prop]=source[prop];}}});return obj;};CORE.extend=function(protoProps,classProps){var child=inherits(this,protoProps,classProps);child.extend=this.extend;return child;};CORE.Session=function(_objTransmitter){var _arrCookiesSent=[],fnExistingOnLoad,_guidSId=localWindow.CAN_SId||null,intTimeoutId,_objTracker,ses_Separator="!",ses_CookieName="CAN_SId",ses_Frequency=gS.Settings.getHeartbeat(),ses_Length=1800,ses_PId=null,ses_HeartB_st=null,ses_GoalNo=0,ses_InternalGoalNo=0,_bLoading=false;function _fnSetTracker(objTracker){_objTracker=objTracker;}function isSId_t_Valid(strT_MS){var intT=gCAN.Utilities.getTimeSeconds(strT_MS);return((intT-ses_HeartB_st)<ses_Length)?true:false;}function isSId_Valid(){if(null===_guidSId){return false;}if("null"===_guidSId){return false;}if(undefined===_guidSId){return false;}return true;}function _fnUpdateCookie(arrCookiesToAdd){if(!isSId_Valid()){return;}var sessionData=_guidSId+ses_Separator+ses_HeartB_st+ses_Separator+ses_GoalNo,i,j,objOldCookie,arrOldKeys,objNewCookie,arrNewKeys,bFound;arrCookiesToAdd=gCAN.Utilities.isDefined(arrCookiesToAdd)?arrCookiesToAdd:[];for(i=0;i<_arrCookiesSent.length;i++){bFound=false;objOldCookie=_arrCookiesSent[i];arrOldKeys=Object.keys(objOldCookie);for(j=0;j<arrCookiesToAdd.length;j++){objNewCookie=arrCookiesToAdd[j];arrNewKeys=Object.keys(objNewCookie);if(arrNewKeys[0]===arrOldKeys[0]){bFound=true;}}if(!bFound){arrCookiesToAdd.push(objOldCookie);}}sessionData=sessionData+ses_Separator+JSON.stringify(arrCookiesToAdd);gCAN.Utilities.Cookies.setCookie(ses_CookieName,sessionData,ses_Length);_arrCookiesSent=arrCookiesToAdd;}function _fnIsSessionValid(){if(false===isSId_t_Valid(new Date().getTime())){return false;}if(false===isSId_Valid()){return false;}return true;}function _fnCreateSessionOnLoad(){if(intTimeoutId){localWindow.clearTimeout(intTimeoutId);intTimeoutId=undefined;}if(fnExistingOnLoad){fnExistingOnLoad(arguments);}gCAN.Utilities.loadScript(gS.Settings.getUrlSJS(gS.Identity.getTId()),function(){_bLoading=false;var envelope=new CORE.Envelope.Session({arrCookiesSent:_arrCookiesSent});_objTransmitter.addItem(envelope);_fnUpdateCookie(envelope.getMatchedCookiesArr());});}function _fnCreateSession(){ses_HeartB_st=gCAN.Utilities.getTimeSeconds();_guidSId=null;ses_GoalNo=0;ses_InternalGoalNo=0;if(!gCAN.Utilities.isDefined(gS.Identity.getTId())){return;}if(false===_bLoading){_bLoading=true;fnExistingOnLoad=localWindow.onload;localWindow.onload=_fnCreateSessionOnLoad;intTimeoutId=localWindow.setTimeout(_fnCreateSessionOnLoad,gS.Settings.getTransmitterTimeout()*1000);}}function _fnSes_heartbeat(){if(false===_fnIsSessionValid()){_fnCreateSession();}else{var oldHBtime=ses_HeartB_st,hbDur,heartbeatEnvelope;ses_HeartB_st=gCAN.Utilities.getTimeSeconds();hbDur=ses_HeartB_st-oldHBtime;if(0<hbDur){heartbeatEnvelope=new CORE.Envelope.Heartbeat();heartbeatEnvelope.create(hbDur);_objTransmitter.addItem(heartbeatEnvelope);}_fnUpdateCookie();}}function _loadSIdFromCookie(){var strData,arrData,gNo;strData=gCAN.Utilities.Cookies.getCookie(ses_CookieName);if(strData){arrData=strData.split(ses_Separator,4);_guidSId=arrData[0];ses_HeartB_st=parseInt(arrData[1],10);gNo=(undefined===arrData[2]||isNaN(arrData[2]))?0:parseInt(arrData[2],10);_arrCookiesSent=(undefined!==arrData[3])?eval(arrData[3]):[];ses_GoalNo=gNo;ses_InternalGoalNo=gNo;if(true===isSId_Valid()){return isSId_t_Valid(gS.Identity.getTimeMS());}}return false;}return{construct:function(){if(true===_loadSIdFromCookie()){var sessionEnvelope=new CORE.Envelope.Session({arrCookiesSent:_arrCookiesSent});_objTransmitter.addItem(sessionEnvelope);_fnUpdateCookie(sessionEnvelope.getMatchedCookiesArr());}else{_fnCreateSession();}},setTracker:function(objTracker){_fnSetTracker(objTracker);},ses_heartbeat:function(){_fnSes_heartbeat();},createSession:function(){_fnCreateSession();},getSes_Frequency:function(){return ses_Frequency;},getSes_PId:function(){return ses_PId;},getSId:function(){return _guidSId;},setSId:function(sid){_guidSId=sid;},setSes_PId:function(oSPid){ses_PId=oSPid;},setSes_HeartB_st:function(sHB){ses_HeartB_st=sHB;},isSessionValid:function(){return _fnIsSessionValid();},setupHeartbeat:function(){ses_PId=localWindow.setInterval(function(){var fnCore=localWindow.canddi.getModule("Core");fnCore.updateHeartbeat();},ses_Frequency*1000);},Gn:function(bIncI){ses_GoalNo+=1;if(true===bIncI){ses_InternalGoalNo=ses_GoalNo;}_fnUpdateCookie();return ses_GoalNo;},Gni:function(){return ses_InternalGoalNo;},St:function(){return ses_HeartB_st;},updateCookie:function(arrCookies){return _fnUpdateCookie(arrCookies);}};};CORE.Handler={};CORE.Handler.AbstractHandler=function(objTransmitter){this._objTransmitter=objTransmitter;this.initialize(this,objTransmitter);};CORE._extend(CORE.Handler.AbstractHandler.prototype,{getTransmitter:function(){if(null===this._objTransmitter){throw new Error("CORE.Handler.AbstractHandler::Transmitter hasn't been set");}return this._objTransmitter;},initialize:function(){}});CORE.Handler.AbstractHandler.extend=CORE.extend;CORE.Handler.ScrollHandler=CORE.Handler.AbstractHandler.extend({bStartOnce:false,bScrolled:false,intScrollInterval:0,intMaxScroll:0,_fnPreviousScroll:null,_fnPageHeight:function(){var objViewport=gCAN.Utilities.Display.getViewportSize();if(gCAN.Utilities.isDefined(objViewport)){return objViewport.Height;}return;},_fnWindowOnScroll:function(){this.bScrolled=true;if(this._fnPreviousScroll){this._fnPreviousScroll();}},_fnCheckScroll:function(){if(this.bScrolled){this.bScrolled=false;var position,scrollEnvelope;position=0;if(gCAN.Utilities.isDefined(localWindow.pageYOffset)){position=localWindow.pageYOffset;}else{if(gCAN.Utilities.isDefined(localWindow.document.documentElement.scrollTop)&&localWindow.document.documentElement.scrollTop>0){position=localWindow.document.documentElement.scrollTop;}else{if(gCAN.Utilities.isDefined(localWindow.document.body.scrollTop)){position=localWindow.document.body.scrollTop;}}}position=position+this._fnPageHeight();if((this.intMaxScroll+this.intScrollInterval)<position){this.intMaxScroll=position+this._fnPageHeight();scrollEnvelope=new CORE.Envelope.Scroll();scrollEnvelope.create(this.intMaxScroll,gCAN.Utilities.Display.getViewportSize());this.getTransmitter().addItem(scrollEnvelope,true);}return position;}},initialize:function(objTransmitter){if(true===this.bStartOnce){return false;}this.bStartOnce=true;var strSettings,that=this;this.intMaxScroll=this._fnPageHeight();this._fnPreviousScroll=localWindow.onscroll;localWindow.onscroll=function(){that._fnWindowOnScroll();};strSettings=gS.Settings.getScroll();if("%"===strSettings.slice(-1)){this.intScrollInterval=Math.floor(this._fnPageHeight()*(strSettings.slice(0,-1)/100));
}else{this.intScrollInterval=parseInt(strSettings.slice(0,-2),10);}gCAN.windowAlias.setInterval(function(){that._fnCheckScroll();},gS.Settings.getScrollTime()*1000);}});CORE.Handler.FormsHander=CORE.Handler.AbstractHandler.extend({trk_bFormTrackingEnabled:false,_addElementToObject:function(objElements,key,value){if(null===value||""===value){return false;}if(gCAN.Utilities.isInstance(objElements[key],Array)){objElements[key].push(value);return true;}if(!gCAN.Utilities.isDefined(objElements[key])){objElements[key]=value;return true;}var oldValue=objElements[key];objElements[key]=[oldValue,value];return true;},_fnDoWeTrackThis:function(elmt){var excludes=gS.Settings.getFormElementExcludes(),strName,strID,intPattern,regexPattern;if(gCAN.Utilities.isDefined(elmt.attributes["data-cdnt"])){return false;}if(gCAN.Utilities.isDefined(elmt.name)){strName=elmt.name;}if(gCAN.Utilities.isDefined(elmt.id)){strID=elmt.id;}for(intPattern=0;intPattern<excludes.length;intPattern++){regexPattern=new RegExp(excludes[intPattern],"i");if(regexPattern.test(strName)||regexPattern.test(strID)){return false;}}return true;},_parseInputElmt:function(elmt,key){if(!gCAN.Utilities.isDefined(elmt)||!gCAN.Utilities.isDefined(elmt.type)){return null;}if("__VIEWSTATE"===key||"__EVENTVALIDATION"===key||"EVENTARGUMENT"===key||"__EVENTTARGET"===key){return null;}switch(elmt.type.toUpperCase()){case"BUTTON":case"PASSWORD":case"RESET":case"SUBMIT":return null;case"CHECKBOX":return elmt.checked;case"HIDDEN":case"FILE":case"TEXT":case"TEXTAREA":return gCAN.Utilities.base64_encode(elmt.value);case"IMAGE":return elmt.alt;case"RADIO":return(true===elmt.checked)?gCAN.Utilities.base64_encode(elmt.value):null;case"SELECT":case"SELECT-ONE":if(gCAN.Utilities.isDefined(elmt.text)){return gCAN.Utilities.base64_encode(elmt.text);}if(gCAN.Utilities.isDefined(elmt.options[elmt.selectedIndex])){return gCAN.Utilities.base64_encode(elmt.options[elmt.selectedIndex].text);}return;case"SELECT-MULTIPLE":return gCAN.Utilities.base64_encode(elmt.value);default:return gCAN.Utilities.base64_encode(elmt.value);}},_trk_Form_SubmitFunction:function(sourceForm,parentFormsHandler){var elements,noElements,intI,strAction,objElements={},elmt,key,value,formEnvelope;elements=sourceForm.elements;noElements=elements.length;strAction=sourceForm.action||gCAN.Utilities.Browser.getUrl();if(!gCAN.Utilities.isString(strAction)){if(gCAN.Utilities.isDefined(strAction.baseURI)){strAction=strAction.baseURI;}else{strAction="UNKNOWN";}}if("hollow"!==gS.Settings.bForms()){for(intI=0;intI<noElements;intI+=1){elmt=elements[intI];if(this._fnDoWeTrackThis(elmt)){key=elmt.name||elmt.id;value=this._parseInputElmt(elmt,key);this._addElementToObject(objElements,key,value);}}}parentFormsHandler.getTransmitter().setLeave(true);formEnvelope=new CORE.Envelope.Form();formEnvelope.create(strAction,objElements);parentFormsHandler.getTransmitter().addItem(formEnvelope,true);parentFormsHandler.getTransmitter().send(true);return true;},_fnFuncback:function(Evnt){var sourceForm;if(!gCAN.Utilities.isDefined(Evnt)){Evnt=gCAN.windowAlias.event;}if(gCAN.Utilities.isDefined(Evnt.target)){sourceForm=Evnt.target;}else{if(gCAN.Utilities.isDefined(Evnt.srcElement)){sourceForm=Evnt.srcElement;}else{return;}}return this._trk_Form_SubmitFunction(sourceForm,this);},initialize:function(){if(true===this.trk_bFormTrackingEnabled){return false;}this.trk_bFormTrackingEnabled=true;var bIE=CORE.documentAlias.all&&!localWindow.opera,docForms=CORE.documentAlias.forms,docForm,intI,that=this,fnCallbackWrapper=function(Event){that._fnFuncback(Event);},fnSubmitForm=function(docForm,scopeObject){that._trk_Form_SubmitFunction(scopeObject,that);docForm._submit();};if(gCAN.Utilities.isDefined(localWindow.HTMLFormElement)&&!bIE){localWindow.HTMLFormElement.prototype._submit=localWindow.HTMLFormElement.prototype.submit;localWindow.HTMLFormElement.prototype.submit=function(){that._trk_Form_SubmitFunction(this,that);if(gCAN.Utilities.isFunction(this._submit)){this._submit();}};}if(docForms){for(intI=0;intI<docForms.length;intI+=1){docForm=docForms[intI];gCAN.Utilities.addEventListener(docForm,"submit",fnCallbackWrapper,false);if(gCAN.Utilities.isFunction(docForm.hasOwnProperty)){if(docForm.hasOwnProperty(docForm.submit)){if(!gCAN.Utilities.isFunction(docForm._submit)){docForm._submit=docForm.submit;docForm.submit=fnSubmitForm(docForm,this);}}}}}return true;}});CORE.Handler.HTML5Handler=CORE.Handler.AbstractHandler.extend({trk_bVideoEnabled:false,fn_genericHandler:function(strEvent,objEvnt,secondsWatched,timeLastSeen){var sourceElement,strRawName,videoName,strVideoName,strName,objElement,eventEnvelope;if(!gCAN.Utilities.isDefined(objEvnt)){objEvnt=localWindow.event;}if(gCAN.Utilities.isDefined(objEvnt.target)){sourceElement=objEvnt.target;}else{if(gCAN.Utilities.isDefined(objEvnt.srcElement)){sourceElement=objEvnt.srcElement;}else{return false;}}if(gCAN.Utilities.isDefined(sourceElement.currentTime)){strRawName=gCAN.Utilities.parseUri(sourceElement.currentSrc).file;videoName=strRawName.substr(0,strRawName.lastIndexOf("."))||strRawName;strVideoName=videoName.replace(/\/|\//g,"").replace(/\s/,"");strName="video/"+strVideoName+"/"+strEvent;objElement={action:strEvent,name:strVideoName};objElement.totalwatchedduration=secondsWatched;objElement.time=Math.round(timeLastSeen/1000);if("volumechange"===strEvent){objElement.volume=Math.round(sourceElement.volume);}else{objElement.timeframe=Math.round(sourceElement.currentTime);objElement.videolength=Math.round(sourceElement.duration);}this.getTransmitter().setLeave(true);eventEnvelope=new CORE.Envelope.Event();eventEnvelope.create(strName,objElement,false,"video");CORE.Singletons.Transmitter.addItem(eventEnvelope,true);}},initialize:function(){if(true===this.trk_bVideoEnabled){return false;}this.trk_bVideoEnabled=true;var secondsWatched=0,that=this,timeLastSeen=new Date().getTime(),fn_timeHandler=function(Evnt){if(1000<(new Date().getTime()-timeLastSeen)){secondsWatched=secondsWatched+1;timeLastSeen=new Date().getTime();}},fn_playHandler=function(Evnt){that.fn_genericHandler("play",Evnt,secondsWatched,timeLastSeen);},fn_pauseHandler=function(Evnt){that.fn_genericHandler("pause",Evnt,secondsWatched,timeLastSeen);},fn_endedHandler=function(Evnt){that.fn_genericHandler("ended",Evnt,secondsWatched,timeLastSeen);},fn_volumechangeHandler=function(Evnt){that.fn_genericHandler("volumechange",Evnt,secondsWatched,timeLastSeen);},listVideoElement=CORE.documentAlias.getElementsByTagName("video"),lenE=listVideoElement.length,intI;for(intI=0;intI<lenE;intI+=1){gCAN.Utilities.addEventListener(listVideoElement[intI],"timeupdate",fn_timeHandler,false);gCAN.Utilities.addEventListener(listVideoElement[intI],"play",fn_playHandler,false);gCAN.Utilities.addEventListener(listVideoElement[intI],"pause",fn_pauseHandler,false);gCAN.Utilities.addEventListener(listVideoElement[intI],"ended",fn_endedHandler,false);gCAN.Utilities.addEventListener(listVideoElement[intI],"volumechange",fn_volumechangeHandler,false);}}});CORE.Handler.LinkHander=CORE.Handler.AbstractHandler.extend({trk_bLinkTrackingEnabled:false,_fn_downloadClickHandler:function(Evnt){var sourceElement,linkEnvelope,sourceHostName,originalSourceHostName,sourceHref,scriptProtocol;if(!gCAN.Utilities.isDefined(Evnt)){Evnt=localWindow.event;}if(gCAN.Utilities.isDefined(Evnt.target)){sourceElement=Evnt.target;}else{if(gCAN.Utilities.isDefined(Evnt.srcElement)){sourceElement=Evnt.srcElement;}else{return false;}}while((null!==sourceElement.parentNode)&&("A"!==sourceElement.tagName)&&("AREA"!==sourceElement.tagName)){sourceElement=sourceElement.parentNode;}if(gCAN.Utilities.isDefined(sourceElement.href)){originalSourceHostName=sourceElement.hostname;sourceHostName=originalSourceHostName.toLowerCase();sourceHref=sourceElement.href.replace(originalSourceHostName,sourceHostName);scriptProtocol=new RegExp("^(javascript|vbscript|jscript|mocha|livescript|ecmascript): *","i");if(!scriptProtocol.test(sourceHref)){this.getTransmitter().setLeave(true);
linkEnvelope=new CORE.Envelope.DownloadLink();linkEnvelope.create(sourceHref);this.getTransmitter().addItem(linkEnvelope,true);}}},_fn_linkClickHandler:function(Evnt){var sourceElement,originalSourceHostName,sourceHostName,sourceHref,scriptProtocol,linkEnvelope;if(!gCAN.Utilities.isDefined(Evnt)){Evnt=localWindow.event;}if(gCAN.Utilities.isDefined(Evnt.target)){sourceElement=Evnt.target;}else{if(gCAN.Utilities.isDefined(Evnt.srcElement)){sourceElement=Evnt.srcElement;}else{return;}}while((null!==sourceElement.parentNode)&&("A"!==sourceElement.tagName)&&("AREA"!==sourceElement.tagName)){sourceElement=sourceElement.parentNode;}if(gCAN.Utilities.isDefined(sourceElement.href)){originalSourceHostName=sourceElement.hostname;sourceHostName=originalSourceHostName.toLowerCase();sourceHref=sourceElement.href.replace(originalSourceHostName,sourceHostName);scriptProtocol=new RegExp("^(javascript|vbscript|jscript|mocha|livescript|ecmascript): *","i");if(!scriptProtocol.test(sourceHref)){this.getTransmitter().setLeave(true);linkEnvelope=new CORE.Envelope.OutboundLink();linkEnvelope.create(sourceHref);this.getTransmitter().addItem(linkEnvelope,true);}}},initialize:function(){if(true===this.trk_bLinkTrackingEnabled){return false;}this.trk_bLinkTrackingEnabled=true;if(!CORE.linkElements){return false;}var trk_configHosts=gS.Settings.getValidHosts(),bTrackDownload=("off"!==gS.Settings.bDownloads()),bTrackLinks=("off"!==gS.Settings.bExternalLinks()),lenE=CORE.linkElements.length,intI,linkElement,that=this,fn_linkCallBack=function(event){that._fn_linkClickHandler(event);},fn_downloadCallBack=function(event){that._fn_downloadClickHandler(event);};for(intI=0;intI<lenE;intI+=1){linkElement=CORE.linkElements[intI];if(gCAN.Utilities.isDocument(linkElement,trk_configHosts)){if(bTrackDownload){gCAN.Utilities.addEventListener(linkElement,"click",fn_downloadCallBack,false);}}else{if(bTrackLinks){if(!gCAN.Utilities.onOurDomain(linkElement.hostname,trk_configHosts)){gCAN.Utilities.addEventListener(linkElement,"click",fn_linkCallBack,false);}}}}}});CORE.Handler.Session=CORE.Handler.AbstractHandler.extend({trk_sessionTracked:false,ses_blur_Handler:function(){if(CORE.Singletons.Session.getSes_PId()){CORE.Singletons.Session.ses_heartbeat();localWindow.clearInterval(CORE.Singletons.Session.getSes_PId());CORE.Singletons.Session.setSes_PId(null);}},ses_focus_Handler:function(){if(null===CORE.Singletons.Session.getSes_PId()){if(false===CORE.Singletons.Session.isSessionValid()){CORE.Singletons.Session.createSession();}CORE.Singletons.Session.setSes_HeartB_st(gCAN.Utilities.getTimeSeconds());}},initialize:function(){if(true===this.trk_sessionTracked){return false;}this.trk_sessionTracked=true;gCAN.Utilities.addEventListener(localWindow,"blur",this.ses_blur_Handler,false);gCAN.Utilities.addEventListener(localWindow,"focus",this.ses_focus_Handler,false);CORE.Singletons.Session.setSes_HeartB_st(gCAN.Utilities.getTimeSeconds());CORE.Singletons.Session.setupHeartbeat();}});CORE.Handler.XmlHttpHandler=CORE.Handler.AbstractHandler.extend({trk_bXMLHttpTrackingEnabled:false,initialize:function(){if(true===this.trk_bXMLHttpTrackingEnabled){return;}this.trk_bXMLHttpTrackingEnabled=true;var OXMLHttpRequest=localWindow.XMLHttpRequest,bGecko=!!localWindow.controllers,bIE=CORE.documentAlias.all&&!localWindow.opera,bIE7=bIE&&CORE.navigatorAlias.userAgent.match(/MSIE ([\.0-9]+)/)&&RegExp.$1===7,parentXmlHttpHandler=this,LocXMLHttpRequest=function(){this._object=(OXMLHttpRequest&&!bIE7)?new OXMLHttpRequest():new localWindow.ActiveXObject("Microsoft.XMLHTTP");this._listeners=[];this._sendItem=new CORE.Envelope.XMLHttp();var fnCanddiSendItem=function(xmlHttpObject){xmlHttpObject._sendItem.status(xmlHttpObject.status);if(false===xmlHttpObject._sendItem.skipDomain()){parentXmlHttpHandler.getTransmitter().addItem(xmlHttpObject._sendItem);}};this.addEventListener("load",function(){fnCanddiSendItem(this);},false);this.addEventListener("error",function(){fnCanddiSendItem(this);},false);};if(bGecko&&OXMLHttpRequest.wrapped){LocXMLHttpRequest.wrapped=OXMLHttpRequest.wrapped;}LocXMLHttpRequest.UNSENT=0;LocXMLHttpRequest.OPENED=1;LocXMLHttpRequest.HEADERS_RECEIVED=2;LocXMLHttpRequest.LOADING=3;LocXMLHttpRequest.DONE=4;LocXMLHttpRequest.prototype.readyState=LocXMLHttpRequest.UNSENT;LocXMLHttpRequest.prototype.responseText="";LocXMLHttpRequest.prototype.responseXML=null;LocXMLHttpRequest.prototype.status=0;LocXMLHttpRequest.prototype.statusText="";LocXMLHttpRequest.prototype.onreadystatechange=null;LocXMLHttpRequest.onreadystatechange=null;LocXMLHttpRequest.onopen=null;LocXMLHttpRequest.onsend=null;LocXMLHttpRequest.onabort=null;function fReadyStateChange(oRequest){if(LocXMLHttpRequest.onreadystatechange){LocXMLHttpRequest.onreadystatechange.apply(oRequest);}oRequest.dispatchEvent({"type":"readystatechange","bubbles":false,"cancelable":false,"timeStamp":new Date().getTime()});}function fGetDocument(oRequest){var oDocument=oRequest.responseXML,sResponse=oRequest.responseText;if(bIE&&sResponse&&oDocument&&!oDocument.documentElement&&oRequest.getResponseHeader("Content-Type").match(/[\^\/]+\/[\^\+]+\+xml/)){oDocument=new localWindow.ActiveXObject("Microsoft.XMLDOM");oDocument.async=false;oDocument.validateOnParse=false;oDocument.loadXML(sResponse);}if(oDocument){if((bIE&&oDocument.parseError!==0)||!oDocument.documentElement||(oDocument.documentElement&&oDocument.documentElement.tagName==="parsererror")){return null;}return oDocument;}}function fSynchronizeValues(oRequest){try{oRequest.responseText=oRequest._object.responseText;}catch(e1){}try{oRequest.responseXML=fGetDocument(oRequest._object);}catch(e2){}try{oRequest.status=oRequest._object.status;}catch(e3){}try{oRequest.statusText=oRequest._object.statusText;}catch(e4){}}function fCleanTransport(oRequest){oRequest._object.onreadystatechange=new localWindow.Function();}LocXMLHttpRequest.prototype.open=function(sMethod,sUrl,bAsync,sUser,sPassword){delete this._headers;this._sendItem.verb(sMethod);this._sendItem.xhttpURL(sUrl);if(arguments.length<3){bAsync=true;}this._async=bAsync;var oRequest=this,nState=this.readyState,fOnUnload;if(bIE&&bAsync){fOnUnload=function(){if(nState!==LocXMLHttpRequest.DONE){fCleanTransport(oRequest);oRequest.abort();}};localWindow.attachEvent("onunload",fOnUnload);}if(LocXMLHttpRequest.onopen){LocXMLHttpRequest.onopen.apply(this,arguments);}if(arguments.length>4){this._object.open(sMethod,sUrl,bAsync,sUser,sPassword);}else{if(arguments.length>3){this._object.open(sMethod,sUrl,bAsync,sUser);}else{this._object.open(sMethod,sUrl,bAsync);}}if(!bGecko&&!bIE){this.readyState=LocXMLHttpRequest.OPENED;fReadyStateChange(this);}this._object.onreadystatechange=function(){if(bGecko&&!bAsync){return;}oRequest.readyState=oRequest._object.readyState;fSynchronizeValues(oRequest);if(oRequest._aborted){oRequest.readyState=LocXMLHttpRequest.UNSENT;return;}if(LocXMLHttpRequest.DONE===oRequest.readyState){fCleanTransport(oRequest);if(bIE&&bAsync){localWindow.detachEvent("onunload",fOnUnload);}oRequest.dispatchEvent({"type":"load"});}if(nState!==oRequest.readyState){fReadyStateChange(oRequest);}nState=oRequest.readyState;};};LocXMLHttpRequest.prototype.send=function(vData){this._sendItem.postData(vData);if(LocXMLHttpRequest.onsend){LocXMLHttpRequest.onsend.apply(this,arguments);}if(vData&&vData.nodeType){vData=localWindow.XMLSerializer?new localWindow.XMLSerializer().serializeToString(vData):vData.xml;if(!this._headers["Content-Type"]){this._object.setRequestHeader("Content-Type","application/xml");}}this._object.send(vData);if(bGecko&&!this._async){this.readyState=LocXMLHttpRequest.OPENED;fSynchronizeValues(this);while(this.readyState<LocXMLHttpRequest.DONE){this.readyState++;fReadyStateChange(this);if(this._aborted){return;}}}};LocXMLHttpRequest.prototype.abort=function(){if(LocXMLHttpRequest.onabort){LocXMLHttpRequest.onabort.apply(this,arguments);}if(this.readyState>LocXMLHttpRequest.UNSENT){this._aborted=true;}this._object.abort();fCleanTransport(this);};LocXMLHttpRequest.prototype.getAllResponseHeaders=function(){return this._object.getAllResponseHeaders();
};LocXMLHttpRequest.prototype.getResponseHeader=function(sName){return this._object.getResponseHeader(sName);};LocXMLHttpRequest.prototype.setRequestHeader=function(sName,sValue){if(!this._headers){this._headers={};}this._headers[sName]=sValue;return this._object.setRequestHeader(sName,sValue);};LocXMLHttpRequest.prototype.addEventListener=function(sName,fHandler,bUseCapture){var nIndex,oListener;for(nIndex=0;nIndex<this._listeners.length;nIndex++){oListener=this._listeners[nIndex];if(oListener[0]===sName&&oListener[1]===fHandler&&oListener[2]===bUseCapture){return;}}this._listeners.push([sName,fHandler,bUseCapture]);};LocXMLHttpRequest.prototype.removeEventListener=function(sName,fHandler,bUseCapture){var nIndex,oListener;for(nIndex=0;nIndex<this._listeners.length;nIndex++){oListener=this._listeners[nIndex];if(oListener[0]===sName&&oListener[1]===fHandler&&oListener[2]===bUseCapture){break;}}if(oListener){this._listeners.splice(nIndex,1);}};LocXMLHttpRequest.prototype.dispatchEvent=function(oEvent){var oEventPseudo={"type":oEvent.type,"target":this,"currentTarget":this,"eventPhase":2,"bubbles":oEvent.bubbles,"cancelable":oEvent.cancelable,"timeStamp":oEvent.timeStamp,"stopPropagation":function(){},"preventDefault":function(){},"initEvent":function(){}},nIndex,oListener;if(oEventPseudo.type==="readystatechange"&&this.onreadystatechange){(this.onreadystatechange.handleEvent||this.onreadystatechange).apply(this,[oEventPseudo]);}for(nIndex=0;nIndex<this._listeners.length;nIndex++){oListener=this._listeners[nIndex];if(oListener[0]===oEventPseudo.type&&!oListener[2]){(oListener[1].handleEvent||oListener[1]).apply(this,[oEventPseudo]);}}};LocXMLHttpRequest.prototype.toString=function(){return"["+"object"+" "+"XMLHttpRequest"+"]";};LocXMLHttpRequest.toString=function(){return"["+"XMLHttpRequest"+"]";};if(!localWindow.Function.prototype.apply){localWindow.Function.prototype.apply=function(oRequest,oArguments){if(!oArguments){oArguments=[];}oRequest.__func=this;oRequest.__func(oArguments[0],oArguments[1],oArguments[2],oArguments[3],oArguments[4]);delete oRequest.__func;};}localWindow.XMLHttpRequest=LocXMLHttpRequest;localWindow.xmlHttp=new LocXMLHttpRequest();}});CORE.Transmitter=function(){var _arrQueueToSend=[],_bOverride=false;return{addItem:function(objItem,bOver){if(!objItem.getURL){return false;}_arrQueueToSend.push(objItem);this.send(bOver);return true;},send:function(bOver){_bOverride=bOver;gCAN.windowAlias.canddi.send();},getEnvelopes:function(){var arrReturned=[];while(_arrQueueToSend.length>0){arrReturned.push(_arrQueueToSend.shift());}return arrReturned;},readyToSend:function(){if(_bOverride){_bOverride=false;return true;}if(null===gS.Identity.getBId()||null===CORE.Singletons.Session.getSId()){return false;}return true;},setLeave:function(bLeave){}};};CORE.Envelope={};CORE.Envelope.Abstract=function(options){this.initialize(options);};CORE._extend(CORE.Envelope.Abstract.prototype,{_qS_getGoal:function(sVerb,sURL,sTitle,arrPost,strGoalType){if(sURL.length>300){sURL=sURL.substring(0,300);}if(arrPost&&arrPost.length>7000){arrPost="CANDDi_Error=Post Length = "+arrPost.length;}if(undefined===strGoalType){strGoalType=gS.Settings.getGoalType();}return"G="+gCAN.escapeWrapper(gCAN.Utilities.base64_encode(window.JSON.stringify({GT:strGoalType,P:gCAN.Utilities.isDefined(arrPost)?gCAN.Utilities.base64_encode(window.JSON.stringify(arrPost)):"",T:(sTitle)?gCAN.Utilities.base64_encode(sTitle):"",U:gCAN.Utilities.base64_encode(gCAN.Utilities.realUrl(sURL)),V:sVerb})));},_qS_getIdentify:function(){return'Id={"B":"'+gS.Identity.getBId()+'", "F":"'+gS.Identity.getFCId()+'"}';},_qS_getReferer:function(strReferrer){if(!gCAN.Utilities.isDefined(strReferrer)){strReferrer=gCAN.Utilities.Browser.referrer();}if(""!==strReferrer){var div=gCAN.documentAlias.createElement("div");div.innerHTML=strReferrer;strReferrer=gCAN.decodeWrapper(gCAN.escapeWrapper(div.firstChild.nodeValue));}return"Ref="+gCAN.escapeWrapper(gCAN.Utilities.base64_encode(strReferrer));},_qS_getSession:function(Gn){return'S={"SId":"'+CORE.Singletons.Session.getSId()+'", "TId":"'+gS.Identity.getTId()+'", "GNo":"'+Gn+'"}';},create:function(){throw new Error("CORE.Envelope.Abstract::create()");},getDelay:function(){return 0;},getSessionGoalNumber:function(bIncrement){return CORE.Singletons.Session.Gn(bIncrement);},initialize:function(options){},sendType:function(){return"JSON";}});CORE.Envelope.Abstract.extend=CORE.extend;CORE.Envelope.DownloadLink=CORE.Envelope.Abstract.extend({create:function(sourceHref){this._strURL=sourceHref;},getURL:function(){var piecesOfDomain=gCAN.Utilities.parseUri(this._strURL),fileType=gCAN.Utilities.getExtension(piecesOfDomain.file),strTitle="Document: "+((""!==piecesOfDomain.file)?piecesOfDomain.file:piecesOfDomain.path),strType="download",arrParams={"Type":(null===fileType)?"":fileType[0].replace(".","")};return gS.Settings.getUrlSession()+"?"+this._qS_getIdentify()+"&"+this._qS_getSession(this.getSessionGoalNumber())+"&"+this._qS_getGoal("GET",this._strURL,strTitle,arrParams,strType);}});CORE.Envelope.Event=CORE.Envelope.Abstract.extend({create:function(strName,objElement,bNewGoal,strGoalType){this._strURL=gCAN.Utilities.Browser.getUrl();this._strTitle=strName;this._bNewGoal=bNewGoal;this._objElement=objElement;this._strGoalType=strGoalType;},getURL:function(){return gS.Settings.getUrlEvent()+"?"+this._qS_getIdentify()+"&"+this._qS_getSession(this.getSessionGoalNumber())+"&"+this._qS_getGoal("EVENT",this._strURL,this._strTitle,this._objElement,this._strGoalType)+"&"+this._qS_getReferer();}});CORE.Envelope.Form=CORE.Envelope.Abstract.extend({create:function(strAction,objElements){this._strAction=strAction;this._arElmt=objElements;},getDelay:function(){return 400;},getURL:function(){return gS.Settings.getUrlForm()+"?"+this._qS_getIdentify()+"&"+this._qS_getSession(this.getSessionGoalNumber())+"&"+this._qS_getGoal("POST",this._strAction,"",this._arElmt);}});CORE.Envelope.Heartbeat=CORE.Envelope.Abstract.extend({create:function(hbDur){this._hbDur=hbDur;},getURL:function(){var objSes=this._qS_getSession(CORE.Singletons.Session.Gni());return gS.Settings.getUrlHeart()+"?d="+this._hbDur+"&"+objSes;},sendType:function(){return"GIF";}});CORE.Envelope.OutboundLink=CORE.Envelope.Abstract.extend({create:function(strURL){this._strURL=strURL;},getURL:function(){return gS.Settings.getUrlOut()+"?"+this._qS_getIdentify()+"&"+this._qS_getSession(this.getSessionGoalNumber())+"&"+this._qS_getGoal("GET",this._strURL);}});CORE.Envelope.Session=CORE.Envelope.Abstract.extend({_arrCookiesSent:[],_arrCacheMatched:[],_getScreen:function(){var objScreen=gCAN.Utilities.Display.getScreenSize(),objViewport=gCAN.Utilities.Display.getViewportSize(),objReturned={SH:objScreen.Height,WH:objViewport.Height,SW:objScreen.Width,WW:objViewport.Width};return"W="+localWindow.JSON.stringify(objReturned);},_getMatchCookies:function(bAsArr){var arrCookiesMatched,i,j,objOldCookie,arrOldKeys,objNewCookie,arrNewKeys;if(this._arrCacheMatched.length<1){arrCookiesMatched=gCAN.Utilities.Cookies.getMatchingCookiesArray(gS.Settings.getCookieMatchArr());for(i=0;i<arrCookiesMatched.length;i++){objOldCookie=arrCookiesMatched[i];arrOldKeys=Object.keys(objOldCookie);for(j=0;j<this._arrCookiesSent.length;j++){objNewCookie=this._arrCookiesSent[j];arrNewKeys=Object.keys(objNewCookie);if(arrNewKeys[0]===arrOldKeys[0]){arrCookiesMatched.splice(i,1);i--;}}}this._arrCacheMatched=arrCookiesMatched;}if(bAsArr){return this._arrCacheMatched;}return(this._arrCacheMatched.length>0)?localWindow.JSON.stringify(this._arrCacheMatched):"";},getMatchedCookiesArr:function(){return this._getMatchCookies(true);},getURL:function(){var strURL=gCAN.Utilities.Browser.getUrl(),strTitle=gCAN.Utilities.Browser.getTitle(),strCookies=this._getMatchCookies(false);if(strCookies.length>0){strCookies="&T="+strCookies;}return gS.Settings.getUrlSession()+"?"+this._qS_getIdentify()+"&"+this._qS_getSession(this.getSessionGoalNumber(true))+"&"+this._qS_getGoal("GET",strURL,strTitle)+"&"+this._qS_getReferer()+"&"+this._getScreen()+strCookies;
},initialize:function(options){this._arrCookiesSent=(gCAN.Utilities.isDefined(options)&&gCAN.Utilities.isDefined(options.arrCookiesSent))?options.arrCookiesSent:[];}});CORE.Envelope.XMLHttp=CORE.Envelope.Abstract.extend({skipDomain:function(){if(false===gS.Settings.bXmlHttp()){return false;}var parseURL=gCAN.Utilities.parseUri(this._xhttpURL),arrExcludesPattern=gS.Settings.getXmlHttpExcludePattern(),arrExcludesDomains=gS.Settings.getXmlHttpExcludeDomains(),strHost=gCAN.Utilities.isDefined(parseURL.host)?parseURL.host:"",strPath=gCAN.Utilities.isDefined(parseURL.path)?parseURL.path:"",bInvalidHost=gCAN.Utilities.inArray(arrExcludesDomains,strHost,gCAN.Utilities.compareEqual),bInvalidPath=false,entry,pathTester;for(entry in arrExcludesPattern){if(arrExcludesPattern.hasOwnProperty(entry)){pathTester=new RegExp(arrExcludesPattern[entry],"i");bInvalidPath=bInvalidPath||pathTester.test(strPath);}}return bInvalidHost||bInvalidPath;},postData:function(postData){if("hollow"===gS.Settings.bXmlHttp()){return;}if(null===postData){return;}var arrExcludedKeys=["AutoFormTechnicalField","id_[0-9]+__.OnClick"],intPlace,rxPatern,objQS={},strKey,arrData=[];if("c0759644351b3a31cde9445c28d061d1"===gS.Identity.getTId()||"95d7bf30bff2a38937fb7585e02e95ae"===gS.Identity.getTId()||"471fdf4335071df10b9d5b0b0b31616c"===gS.Identity.getTId()){try{postData.replace(new RegExp("([^?=&]+)(=([^&]*))?","g"),function($0,$1,$2,$3){objQS[$1]=$3;});}catch(e){}for(strKey in objQS){if(objQS.hasOwnProperty(strKey)){for(intPlace=0;intPlace<arrExcludedKeys.length;intPlace++){try{rxPatern=new RegExp(arrExcludedKeys[intPlace],"i");if(rxPatern.test(strKey)){delete objQS[strKey];break;}}catch(f){}}if(objQS[strKey]){arrData.push(CORE.escapeWrapper(strKey)+"="+CORE.escapeWrapper(objQS[strKey]));}}}postData=arrData.join("&");}this._postData=postData;},status:function(status){this._status=status;},xhttpURL:function(url){this._xhttpURL=url;},verb:function(verb){this._verb=verb;},getURL:function(){return gS.Settings.getUrlXMLHttp()+"?"+this._qS_getIdentify()+"&"+this._qS_getSession(this.getSessionGoalNumber())+"&"+this._qS_getGoal(this._verb,this._xhttpURL,"",this._postData);}});CORE.Envelope.Scroll=CORE.Envelope.Abstract.extend({create:function(intScrollPosition,objViewport){this._intScrollPosition=intScrollPosition;this._objViewport=objViewport;},getURL:function(){return gS.Settings.getUrlScrollPosition()+"?"+this._qS_getSession(CORE.Singletons.Session.Gni())+"&H="+this._intScrollPosition+"&DH="+this._objViewport.Height+"&DW="+this._objViewport.Width;},sendType:function(){return"GIF";}});CORE.Tracker=function(_objTransmitter){return{startTracking:function(){var _fnSettings=gS.Settings,fnHandler;if("off"!==_fnSettings.bForms()){fnHandler=new CORE.Handler.FormsHander(_objTransmitter);}if("off"!==_fnSettings.bXmlHttp()){fnHandler=new CORE.Handler.XmlHttpHandler(_objTransmitter);}if("off"!==_fnSettings.bHTML5Video()){fnHandler=new CORE.Handler.HTML5Handler(_objTransmitter);}if("off"!==_fnSettings.strScrollActive()){fnHandler=new CORE.Handler.ScrollHandler(_objTransmitter);}fnHandler=new CORE.Handler.LinkHander(_objTransmitter);fnHandler=new CORE.Handler.Session(_objTransmitter);},endPage:function(){if(false===CORE.Singletons.Session.isSessionValid()){return;}CORE.Singletons.Session.ses_heartbeat();}};};CORE.sendEvent=function(strName,objElement,bNewGoal,strGoalType){var eventEnvelope=new CORE.Envelope.Event();eventEnvelope.create(strName,objElement,bNewGoal,strGoalType);CORE.Singletons.Transmitter.addItem(eventEnvelope);window.canddi.send();};CORE.start=function(globalC,globalS){gCAN=globalC;gS=globalS;CORE.Singletons={};CORE.Singletons.Transmitter=new CORE.Transmitter();CORE.Singletons.Session=new CORE.Session(CORE.Singletons.Transmitter);var _objTracker=new CORE.Tracker(CORE.Singletons.Transmitter),intI,arrEvents=gS.Settings.getArrStoredEvents(),_fnBeforeUnload_Handler=function(){CORE.Singletons.Transmitter.setLeave(true);_objTracker.endPage();localWindow.canddi.send(true);};CORE.Singletons.Session.setTracker(_objTracker);gCAN.Utilities.addEventListener(localWindow,"beforeunload",_fnBeforeUnload_Handler,false);CORE.Singletons.Session.construct();gCAN.can_bHasLoaded=true;_objTracker.startTracking();for(intI=0;intI<arrEvents.length;intI++){CORE.sendEvent(arrEvents[intI].Type,arrEvents[intI].Value,false);}};window.canddi.addModule((function(){return{Name:"Core",Version:CORE.VERSION,startModule:function(gCAN,gS){CORE.start(gCAN,gS);},getGNo:function(bIncrement){return CORE.Singletons.Session.Gn(bIncrement);},getSId:function(){return CORE.Singletons.Session.getSId();},saveSId:function(SId){CORE.Singletons.Session.setSId(SId);CORE.Singletons.Session.updateCookie();window.canddi.send();},getEnvelopes:function(){return CORE.Singletons.Transmitter.getEnvelopes();},updateHeartbeat:function(){CORE.Singletons.Session.ses_heartbeat();},readyToSend:function(){return CORE.Singletons.Transmitter.readyToSend();},sendEvent:function(strName,objElement,bNewGoal,strGoalType){CORE.sendEvent(strName,objElement,bNewGoal,strGoalType);}};}()));}(window));